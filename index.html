<!-- Copyright (C) 2022 NCHU OSA <dromegen@email.nchu.edu.tw>.

  Portions of this page are modifications based on work created and
  shared by Google and used according to terms described in the
  Creative Commons 4.0 Attribution License.
-->

<!DOCTYPE html>
<html>

<head>
  <title>2022 ä¸­èˆˆå¤§å­¸æŠ½çç³»çµ±</title>
  <meta name="description" content="2022 ä¸­èˆˆå¤§å­¸æŠ½çç³»çµ±">
  <meta charset="utf-8">
  <meta property="og:image" content="https://www.nchu.edu.tw/favicon.ico">
  <link rel="apple-touch-icon" href="https://www.nchu.edu.tw/favicon.ico">
  <link rel="icon" href="https://www.nchu.edu.tw/favicon.ico">
  <!-- google api -->
  <script src="lib/gapi.js"></script>
  <script src="lib/gclient.js"></script>
  <!-- jquery -->
  <script src="lib/jquery-3.6.0.min.js"></script>
  <!-- semantic-ui css, js -->
  <link rel="stylesheet" href="lib/semantic.min.css">
  <script src="lib/semantic.min.js"></script>
  <!-- font-awesome css, js -->
  <link rel="stylesheet" href="lib/fa.all.min.css">
  <script src="lib/fa.all.min.js"></script>
  <!-- React JS åµŒå…¥ https://zh-hant.reactjs.org/docs/add-react-to-a-website.html -->
  <script src="lib/react.production.min.js" crossorigin></script>
  <script src="lib/react-dom.production.min.js" crossorigin></script>
  <script src="lib/babel.min.js"></script>
  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.1/html5shiv.js" type="text/javascript"></script>
  <![endif]-->
  <!-- cssæ¨£å¼ -->
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <div id="é–‹å•Ÿå°è¦½" class="ui vertical animated black button">
    <div class="hidden content">è¨­å®š</div>
    <div class="visible content">
      <i class="fa fa-lg fa-sliders"></i>
    </div>
  </div>
  <!-- å°è¦½åˆ— -->
  <div id="å°è¦½åˆ—">
    <div class="ui grid stackable compact menu secondary attached">
      <a id="ä½¿ç”¨èªªæ˜é ç±¤" class="icon item blue">
        <i class="fa fa-question circle outline
                " aria-hidden="true"></i>
        <span>&nbsp;&nbsp;ç³»çµ±èªªæ˜</span>
      </a>
      <a id="æŠ½çç³»çµ±é ç±¤" class="icon item blue active">
        <i class="fa fa-vote-yea" aria-hidden="true"></i>
        <span>&nbsp;&nbsp;æŠ½çç³»çµ±</span>
      </a>
      <a id="ç·¨è¼¯è³‡æ–™é ç±¤" class="icon item blue">
        <i class="fa fa-edit " aria-hidden="true"></i>
        <span>&nbsp;&nbsp;ç·¨è¼¯è³‡æ–™</span>
      </a>
      <a id="æŠ½ççµæœé ç±¤" class="icon item blue">
        <i class="fa fa-file alternate" aria-hidden="true"></i>
        <span>&nbsp;&nbsp;æŠ½ççµæœ</span>
      </a>
      <div class="right menu">
        <a class="icon item" data-tooltip="çå“é¸å–®" data-position="bottom left">
          <i class="fa fa-gift" aria-hidden="true"></i>
          <span>&nbsp;&nbsp;
            <select id="çå“é¸å–®" class="ui search dropdown">
              <option class="default text" value>æœå°‹çå“...</option>
            </select>
          </span>
        </a>
        <!-- è²éŸ³é–‹å•Ÿ/éœéŸ³ -->
        <div id="éœéŸ³åˆ‡æ›æŒ‰éˆ•" class="cursor_pointer item ui header" data-tooltip="éœéŸ³/åƒ…é»é¸éŸ³æ•ˆ/æ’­æ”¾èƒŒæ™¯éŸ³æ¨‚"
          data-position="bottom right">
          <i class="fa fa-volume-off"></i>
        </div>
        <div id="audio_container">
          <audio type="audio/mpeg" controlslist="nodownload" id="map_background_music" loop src="">ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´éŸ³è¨Š</audio>
          <audio type="audio/mpeg" controlslist="nodownload" id="fight_background_music" loop src="">ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´éŸ³è¨Š</audio>
          <audio type="audio/mpeg" controlslist="nodownload" id="victory_sound_effect" src="">
            ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´éŸ³è¨Š</audio>
          <audio type="audio/mpeg" controlslist="nodownload" id="keep_going_sound_effect" src="">ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´éŸ³è¨Š</audio>
          <audio type="audio/mpeg" controlslist="nodownload" id="panel_btn_click_sound_effect" src="">ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´éŸ³è¨Š</audio>
        </div>
        <div id="ä½¿ç”¨è€…é ­åƒ" class="ui item header" data-tooltip="å°šæœªç™»å…¥" data-position="bottom center">
          <i class="fa fa-question-circle"></i>
        </div>
        <div id="ç™»å…¥æŒ‰éˆ•å€å¡Š" class="icon item" data-tooltip="ç™»å…¥ Google å¸³è™Ÿ ä»¥å­˜å–è©¦ç®—è¡¨" data-position="bottom center">
          <div id="ç™»å…¥æŒ‰éˆ•" class="positive ui button" style="display:none">ç™»å…¥</div>
          <div id="ç™»å‡ºæŒ‰éˆ•" class="google plus ui vertical animated black button" style="display:none">
            <div class="visible content"><span id="ä½¿ç”¨è€…åç¨±"></span></div>
            <div class="hidden content">ç™»å‡º</div>
          </div>
          <div id="è¼‰å…¥æŒ‰éˆ•" class="ui loading button">è¼‰å…¥</div>
        </div>
        <div id="é—œé–‰å°è¦½" class="ui icon item" data-tooltip="æ”¶åˆè¨­å®šæ¬„" data-position="bottom right">
          <i class="fa fa-lg fa-square-minus"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- ä½¿ç”¨èªªæ˜åˆ†é  -->
  <div id="ä½¿ç”¨èªªæ˜åˆ†é " style="display:none">
    <div class="vh100">
      <!-- hackmd ä½¿ç”¨èªªæ˜-->
      <iframe id="èªªæ˜" frame-border="0" src="https://hackmd.io/@NCHUIT/OSA-draw">èªªæ˜è¼‰å…¥ä¸­...</iframe>
    </div>
  </div>

  <!-- æŠ½çç³»çµ±åˆ†é  -->
  <div id="æŠ½çç³»çµ±åˆ†é ">
    <iframe frameborder="0" noresize="noresize">
      <!-- è¼‰å…¥ç•«é¢èªªæ˜æ¡† -->
      <div id="è¼‰å…¥æç¤º" class="ui active dimmer" style="display:none">
        <div class="ui massive text loader">
          æŠ½çç³»çµ±è¼‰å…¥ä¸­...
        </div>
      </div>
    </iframe>
  </div>

  <!-- ç·¨è¼¯è³‡æ–™åˆ†é  -->
  <div id="ç·¨è¼¯è³‡æ–™åˆ†é " style="display:none">
    <div>
      <ul>
        <li>
          <h3>å¡«å¯«æ–°å¢è³‡æ–™è¡¨å–®</h3>
          <button id="æ–°å¢åŒå­¸åå–®æŒ‰éˆ•" class="edit_btn">æ–°å¢åŒå­¸åå–®</button>
          <button id="æ–°å¢çå“è³‡æ–™æŒ‰éˆ•" class="edit_btn">æ–°å¢çå“è³‡æ–™</button>
        </li>
        <li>
          <h3>ä½¿ç”¨è©¦ç®—è¡¨æ–°å¢/åˆªé™¤è³‡æ–™</h3>
          <a class="icon item" target="_blank"
            href="https://docs.google.com/spreadsheets/d/1uPs6CBFz1edahBCSY8HzUTmippmlutsDuhFfvM1tsiw">
            <img src="https://i.imgur.com/ky2ykVM.png">
          </a>
        </li>
        <li>
          <h3>ä½¿ç”¨è©¦ç®—è¡¨ csv æª”æ¡ˆè¼‰å…¥ã€ŒåŒå­¸ã€è³‡æ–™</h3>
          <input id="åŒå­¸æª”æ¡ˆè¼¸å…¥æ¡†" type="file">
          <label id="åŒå­¸æª”æ¡ˆè³‡æ–™æ¡†" for="åŒå­¸æª”æ¡ˆè¼¸å…¥æ¡†">æœªæ”¾ç½®æª”æ¡ˆ</label>
        </li>
        <li>
          <h3>ä½¿ç”¨è©¦ç®—è¡¨ csv æª”æ¡ˆè¼‰å…¥ã€Œçå“ã€è³‡æ–™</h3>
          <input id="çå“æª”æ¡ˆè¼¸å…¥æ¡†" type="file">
          <label id="çå“æª”æ¡ˆè³‡æ–™æ¡†" for="çå“æª”æ¡ˆè¼¸å…¥æ¡†">æœªå¯¦ä½œ</label>
        </li>
      </ul>
    </div>
    <!-- googleè¡¨å–®å¡«å¯«-åŒå­¸åå–® -->
    <iframe id="æ–°å¢åŒå­¸è¡¨å–®" class="ui segment" frameborder="0" scrolling="no"
      src="https://docs.google.com/forms/d/e/1FAIpQLSfMexnj15dM3iVNx0CV5Jq46yBfB51AenZmMiWmPRjo-yIMeA/viewform?embedded=true">è¼‰å…¥ä¸­â€¦</iframe>
    <!-- googleè¡¨å–®å¡«å¯«-çå“ç·¨è¼¯ -->
    <iframe id="æ–°å¢çå“è¡¨å–®" class="ui segment" frameborder="0" scrolling="no"
      src="https://docs.google.com/forms/d/e/1FAIpQLSfPC-JJJOaR8dMcbSJqO03xcDDnIgWok56eQoqXG5mm3-PH7A/viewform?embedded=true">è¼‰å…¥ä¸­â€¦</iframe>
  </div>
  <!-- æŠ½ççµæœåˆ†é  -->
  <div id="æŠ½ççµæœåˆ†é " style="display:none">
    <div class="ui segment">
      <pre id="ç‹€æ…‹æ¬„" class="ui container">ğŸ‘‰è³‡æ–™è¼‰å…¥ä¸­â€¦<br></pre>
    </div>
  </div>

  <!-- è‡³é ‚æŒ‰éˆ• -->
  <div id="è‡³é ‚æŒ‰éˆ•" class="cursor_pointer circular massive ui negative icon button" data-tooltip="å›åˆ°æœ€ä¸Šé¢"
    data-position="top right" data-inverted><i class="angle double up icon"></i></div>

  <!-- footer -->
  <div class="ui inverted footer bottom text menu">
    <div class="ui container">
      <div class="item">
        Â©Copyright 2022 Office of Student Affairs NCHU All Rights Reserved
      </div>
    </div>
  </div>

  <!-- éŒ¯èª¤è¨Šæ¯æç¤ºæ¡† -->
  <div id="éŒ¯èª¤è¨Šæ¯è¦–çª—" class="ui tiny modal">
    <div class="header">âš ï¸éŒ¯èª¤è¨Šæ¯</div>
    <pre id="éŒ¯èª¤è¨Šæ¯è¦–çª—å…§æ–‡" class="content"></pre>
    <div class="actions">
      <div id="éŒ¯èª¤è¨Šæ¯è¦–çª—ç™»å…¥æŒ‰éˆ•" class="ui positive button">é‡æ–°ç™»å…¥</div>
      <div class="ui negative button">é—œé–‰</div>
    </div>
  </div>

  <!-- è¼‰å…¥ç•«é¢èªªæ˜æ¡† -->
  <div id="è¼‰å…¥æç¤º" class="ui active dimmer" style="display:none">
    <div class="ui massive text loader">
      è¼‰å…¥ä¸­<br>
      æœªç™»å…¥è«‹è‡³å³ä¸Šæ–¹ç™»å…¥<br>
      å·²ç™»å…¥é²é²æœªè¼‰å…¥è«‹é»æˆ‘<br>
      æ»‘é¼ ç§»åˆ°ä¸Šæ–¹æŒ‰éˆ•ç„¡åæ‡‰æ™‚<br>
      è«‹éµ <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>Delete</kbd><br>
      ä¸¦æ¸…é™¤ç€è¦½å™¨ Cookie
    </div>
  </div>

  <iframe name="formResponse" sandbox="allow-scripts allow-same-origin" tabindex="-1" aria-hidden="true"
    frame-border="0"></iframe>

  <script>//å®£ç©
    "use strict";
    $(document).ready(() => {
      $('#çå“é¸å–®').dropdown();
      $('#é–‹å•Ÿå°è¦½').hide();

      $('#é—œé–‰å°è¦½').click(() => {
        $('#å°è¦½åˆ—').transition('fade down');
        $('#é–‹å•Ÿå°è¦½').show();
      })
      $('#é–‹å•Ÿå°è¦½').click(() => {
        $('#å°è¦½åˆ—').transition('fade up');
        $('#é–‹å•Ÿå°è¦½').css('display', 'none');
      })
    })
    $('#æ–°å¢åŒå­¸åå–®æŒ‰éˆ•').click(() => {
      var position = document.getElementById("æ–°å¢åŒå­¸è¡¨å–®");
      position.scrollIntoView();
    })
    $('#æ–°å¢çå“è³‡æ–™æŒ‰éˆ•').click(() => {
      var position = document.getElementById("æ–°å¢çå“è¡¨å–®");
      position.scrollIntoView();
    })

    const éœéŸ³åˆ‡æ›æŒ‰éˆ• = document.getElementById("éœéŸ³åˆ‡æ›æŒ‰éˆ•");//TO-DO

    function éœéŸ³åˆ‡æ›() {//TO-DO
      switch (éœéŸ³ç‹€æ…‹) {
        default:
        case 0: éœéŸ³ç‹€æ…‹ = 1;
          éœéŸ³åˆ‡æ›æŒ‰éˆ•.innerHTML = `<i class="fa fa-volume-down"></i>`;
          éœéŸ³åˆ‡æ›æŒ‰éˆ•.setAttribute("data-tooltip", "åƒ…é»é¸éŸ³æ•ˆ");
          æ­£è§£éŸ³æ•ˆ.muted = éŒ¯é¡ŒéŸ³æ•ˆ.muted = é»æ“ŠéŸ³æ•ˆ.muted = false;
          return 1;
        case 1: éœéŸ³ç‹€æ…‹ = 2;
          éœéŸ³åˆ‡æ›æŒ‰éˆ•.innerHTML = `<i class="fa fa-volume-up"></i>`;
          éœéŸ³åˆ‡æ›æŒ‰éˆ•.setAttribute("data-tooltip", "æ’­æ”¾èƒŒæ™¯éŸ³æ¨‚");
          ç›®å‰èƒŒæ™¯éŸ³æ¨‚.muted = false;
          ç›®å‰èƒŒæ™¯éŸ³æ¨‚.play();
          return 2;
        case 2: éœéŸ³ç‹€æ…‹ = 0;
          éœéŸ³åˆ‡æ›æŒ‰éˆ•.innerHTML = `<i class="fa fa-volume-mute"></i>`;
          éœéŸ³åˆ‡æ›æŒ‰éˆ•.setAttribute("data-tooltip", "éœéŸ³");
          æ­£è§£éŸ³æ•ˆ.muted = éŒ¯é¡ŒéŸ³æ•ˆ.muted = é»æ“ŠéŸ³æ•ˆ.muted = true;
          ç›®å‰èƒŒæ™¯éŸ³æ¨‚.muted = true;
          return 0;
      }
    }
  </script>

  <script>//ç¶­å‚‘
    'use strict';
    var ç›®å‰é é¢ = 'æŠ½çç³»çµ±';
    function åˆ‡æ›åˆ†é (å•¥ = '') {
      $(`#${ç›®å‰é é¢}åˆ†é `).hide();
      $(`#${ç›®å‰é é¢}é ç±¤`).removeClass('active');
      ç›®å‰é é¢ = å•¥;
      $(`#${å•¥}åˆ†é `).show();
      $(`#${å•¥}é ç±¤`).addClass('active');
    }
    for (const å•¥ of ['ä½¿ç”¨èªªæ˜', 'æŠ½çç³»çµ±', 'ç·¨è¼¯è³‡æ–™', 'æŠ½ççµæœ'])
      $(`#${å•¥}é ç±¤`).click(ev => åˆ‡æ›åˆ†é (å•¥));

    const åŒå­¸æª”æ¡ˆè³‡æ–™æ¡† = document.getElementById('åŒå­¸æª”æ¡ˆè³‡æ–™æ¡†');
    const è®€æª”å™¨ = new FileReader();

    è®€æª”å™¨.onload = () => {
        // this will then display a text file
        var æª”æ¡ˆè³‡æ–™ = è®€æª”å™¨.result.split('\r\n');
        æª”æ¡ˆè³‡æ–™.shift();
        æª”æ¡ˆè³‡æ–™ = æª”æ¡ˆè³‡æ–™.map(è¡Œ => {
          const è½‰æ› = è¡Œ.split(',');
          è½‰æ›.shift();
          return è½‰æ›;
        });
        console.log(æª”æ¡ˆè³‡æ–™);
        åŒå­¸æª”æ¡ˆè³‡æ–™æ¡†.innerText = `å…±è¼‰å…¥${æª”æ¡ˆè³‡æ–™.length}ç­†å­¸ç”Ÿè³‡æ–™`;
        é‡è¼‰è³‡æ–™åº«(æª”æ¡ˆè³‡æ–™);
    };
    document.getElementById("åŒå­¸æª”æ¡ˆè¼¸å…¥æ¡†").onchange = ev => {
      const [æª”æ¡ˆ] = ev.target.files;
      if (æª”æ¡ˆ) è®€æª”å™¨.readAsText(æª”æ¡ˆ);
    };

    var çå“è³‡æ–™åº« = [], æš«å­˜åŒå­¸è³‡æ–™åº« = [], åŒå­¸è³‡æ–™åº« = [], ç›®å‰ä¸­çåŒå­¸ = [], å·²ä¸­çæš«å­˜è³‡æ–™åº« = [], ç™»å…¥ç‹€æ…‹;

    const ä½¿ç”¨è€…åç¨± = document.getElementById('ä½¿ç”¨è€…åç¨±'),
      ä½¿ç”¨è€…é ­åƒ = document.getElementById('ä½¿ç”¨è€…é ­åƒ'),
      ç™»å…¥æŒ‰éˆ•å€å¡Š = document.getElementById('ç™»å…¥æŒ‰éˆ•å€å¡Š'),
      ç™»å…¥æŒ‰éˆ• = document.getElementById('ç™»å…¥æŒ‰éˆ•'),
      ç™»å‡ºæŒ‰éˆ• = document.getElementById('ç™»å‡ºæŒ‰éˆ•'),
      è¼‰å…¥æŒ‰éˆ• = document.getElementById('è¼‰å…¥æŒ‰éˆ•'),
      è¼‰å…¥æç¤º = document.getElementById('è¼‰å…¥æç¤º'),
      è‡³é ‚æŒ‰éˆ• = document.getElementById('è‡³é ‚æŒ‰éˆ•'),
      ç‹€æ…‹æ¬„ = document.getElementById('ç‹€æ…‹æ¬„'),
      éŒ¯èª¤è¨Šæ¯è¦–çª— = document.getElementById('éŒ¯èª¤è¨Šæ¯è¦–çª—'),
      éŒ¯èª¤è¨Šæ¯è¦–çª—å…§æ–‡ = document.getElementById('éŒ¯èª¤è¨Šæ¯è¦–çª—å…§æ–‡'),
      éŒ¯èª¤è¨Šæ¯è¦–çª—ç™»å…¥æŒ‰éˆ• = document.getElementById('éŒ¯èª¤è¨Šæ¯è¦–çª—ç™»å…¥æŒ‰éˆ•');

    // From https://stackoverflow.com/questions/951021/what-is-the-javascript-version-of-sleep
    const sleep = (ms = 0) => new Promise(r => setTimeout(r, ms));

    /** From https://developers.google.com/sheets/api/quickstart/js  
     *  Called when the signed in status changes, to update the UI
     *  appropriately. After a sign-in, the API is called.
     */
    function æ›´æ–°ç™»å…¥ç‹€æ…‹(isSignedIn = Boolean(gapi.auth2.getAuthInstance().isSignedIn.get()), åªæ˜¯çœ‹çœ‹ = false) {
      è¼‰å…¥æŒ‰éˆ•.style.display = 'none';
      if (isSignedIn) {
        ç™»å…¥æŒ‰éˆ•.style.display = 'none';
        ç™»å‡ºæŒ‰éˆ•.style.display = 'block';
        if (åªæ˜¯çœ‹çœ‹) return isSignedIn;
        é‡è¼‰è³‡æ–™åº«();
      } else {
        ç™»å…¥æŒ‰éˆ•.style.display = 'block';
        ç™»å‡ºæŒ‰éˆ•.style.display = 'none';
      }
      // From https://developers.google.com/identity/sign-in/web/people
      if (gapi.auth2.getAuthInstance().isSignedIn.get()) {
        const profile = gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile();
        window.profile = profile;
        ä½¿ç”¨è€…åç¨±.innerHTML = profile.getGivenName();
        ä½¿ç”¨è€…é ­åƒ.innerHTML = `<i><img src="${profile.getImageUrl()}"></i>`;
        ä½¿ç”¨è€…é ­åƒ.setAttribute("data-tooltip", profile.getEmail());
        ç™»å…¥æŒ‰éˆ•å€å¡Š.setAttribute("data-tooltip", "å·²ç™»å…¥ " + profile.getEmail());
      } else {
        ä½¿ç”¨è€…åç¨±.innerHTML = "ç™»å‡º";
        ä½¿ç”¨è€…é ­åƒ.innerHTML = `<i class="fa fa-question-circle"></i>`;
        ä½¿ç”¨è€…é ­åƒ.setAttribute("data-tooltip", "å°šæœªç™»å…¥");
        ç™»å…¥æŒ‰éˆ•å€å¡Š.setAttribute("data-tooltip", "ç™»å…¥ Google å¸³è™Ÿ ä»¥å­˜å–è©¦ç®—è¡¨");
      }
      return isSignedIn;
    }

    // From https://stackoverflow.com/a/12646864/13189986
    function æ‰“äº‚é™£åˆ—(é™£åˆ— = []) {
      for (let i = é™£åˆ—.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [é™£åˆ—[i], é™£åˆ—[j]] = [é™£åˆ—[j], é™£åˆ—[i]];
      }
      return é™£åˆ—;
    }

    function æŠ½ç(äººæ•¸ = 1) {// TO-DO
      if (æš«å­˜åŒå­¸è³‡æ–™åº«.length < 1 && !æ›´æ–°ç™»å…¥ç‹€æ…‹()) ç™»å…¥();
      æ‰“äº‚é™£åˆ—(æš«å­˜åŒå­¸è³‡æ–™åº«);
      ç›®å‰ä¸­çåŒå­¸ = [];
      for(let i = 0; i < äººæ•¸ && æš«å­˜åŒå­¸è³‡æ–™åº«.length > 0; ++i)
        ç›®å‰ä¸­çåŒå­¸.push(æš«å­˜åŒå­¸è³‡æ–™åº«.pop());
      for(const ä¸­çåŒå­¸ of ç›®å‰ä¸­çåŒå­¸)
        å·²ä¸­çæš«å­˜è³‡æ–™åº«.push(ä¸­çåŒå­¸);
      if(æš«å­˜åŒå­¸è³‡æ–™åº«.length < 1)
        å½ˆå‡ºéŒ¯èª¤è¨Šæ¯('æ²’æœ‰åŒå­¸å¯ä»¥æŠ½äº†');
      é‡è¨­ç‹€æ…‹æ¬„(ç›®å‰ä¸­çåŒå­¸.reduce(
        (str, row) => `${str}${row[0]}, ${row[1]}, ${row[2]}, ${row[3]}, ${row[4]}\n`,
        `ğŸ‘‰é€™æ¬¡ä¸­çåŒå­¸ï¼Œå…±${ç›®å‰ä¸­çåŒå­¸.length}äºº\nç§‘ç³», å§“å, å­¸è™Ÿ, é›»è©±, åº§ä½\n`
      )+å·²ä¸­çæš«å­˜è³‡æ–™åº«.reduce(
        (str, row) => `${str}${row[0]}, ${row[1]}, ${row[2]}, ${row[3]}, ${row[4]}\n`,
        `ğŸ‘‰æ‰€æœ‰ä¸­çåŒå­¸ï¼Œå…±${å·²ä¸­çæš«å­˜è³‡æ–™åº«.length}äºº\nç§‘ç³», å§“å, å­¸è™Ÿ, é›»è©±, åº§ä½\n`
      )+æš«å­˜åŒå­¸è³‡æ–™åº«.reduce(
        (str, row) => `${str}${row[0]}, ${row[1]}, ${row[2]}, ${row[3]}, ${row[4]}\n`,
        `ğŸ™…æœªä¸­çåŒå­¸ï¼Œå…±${æš«å­˜åŒå­¸è³‡æ–™åº«.length}äºº\nç§‘ç³», å§“å, å­¸è™Ÿ, é›»è©±, åº§ä½\n`
      ));
    }

    // From https://developers.google.com/sheets/api/quickstart/js
    function ç‹€æ…‹æ¬„çºŒå¯«(è¨Šæ¯ = '') {
      ç‹€æ…‹æ¬„.appendChild(document.createTextNode(è¨Šæ¯ + '\n'));
      return è¨Šæ¯;
    }

    function é‡è¨­ç‹€æ…‹æ¬„(è¨Šæ¯ = `ğŸ‘‰å…±è¼‰å…¥${åŒå­¸è³‡æ–™åº«.length}ç­†(æ–°åˆ°èˆŠ)`) {
      ç‹€æ…‹æ¬„.innerHTML = è¨Šæ¯ + '\n';
      return è¨Šæ¯;
    }

    function å½ˆå‡ºéŒ¯èª¤è¨Šæ¯(è¨Šæ¯ = '', ä¸é¡¯ç¤ºç™»å…¥éˆ• = false) {
      é‡è¨­ç‹€æ…‹æ¬„('âš ï¸éŒ¯èª¤è¨Šæ¯');
      ç‹€æ…‹æ¬„çºŒå¯«(è¨Šæ¯);
      éŒ¯èª¤è¨Šæ¯è¦–çª—å…§æ–‡.innerHTML = è¨Šæ¯;
      $('#éŒ¯èª¤è¨Šæ¯è¦–çª—').modal('show');
      éŒ¯èª¤è¨Šæ¯è¦–çª—ç™»å…¥æŒ‰éˆ•.style.display = ä¸é¡¯ç¤ºç™»å…¥éˆ• ? 'none' : 'block';
      éŒ¯èª¤è¨Šæ¯è¦–çª—.style.left = 'unset';
      return è¨Šæ¯;
    }

    // From https://developers.google.com/sheets/api/quickstart/js
    async function é‡è¼‰è³‡æ–™åº«(é è¼‰è³‡æ–™) {
      è¼‰å…¥æç¤º.style.display = 'flex';
      é‡è¨­ç‹€æ…‹æ¬„();
      const è¼‰å…¥æˆåŠŸ = å›æ‡‰ => {
        è¼‰å…¥æç¤º.style.display = 'flex';
        var è³‡æ–™ = é è¼‰è³‡æ–™ ? é è¼‰è³‡æ–™ : å›æ‡‰.result.values;
        if (è³‡æ–™.length > 0) {
          åŒå­¸è³‡æ–™åº« = è³‡æ–™;
          // æŒ‰æœ€å¾Œæ”¶åˆ°çš„åŒå­¸è³‡æ–™ç¯©é¸è³‡æ–™è¡¨
          for(let åˆ—=-1; ++åˆ— < åŒå­¸è³‡æ–™åº«.length-1;){
            const æª¢æŸ¥åˆ— = åŒå­¸è³‡æ–™åº«[åˆ—];
            for(const å…¶å¾Œåˆ— of åŒå­¸è³‡æ–™åº«.slice(åˆ—+1)){
              if(å…¶å¾Œåˆ—[0] && å…¶å¾Œåˆ—[0] === æª¢æŸ¥åˆ—[0]){ // æª¢æŸ¥å­¸è™Ÿ
                for(let æ¬„=0; ++æ¬„ < 5;){ // ä¸€æ¨£å°±å…¨éƒ¨æ¬„ä½æ›¿æ›æ‰
                  // console.log(æª¢æŸ¥åˆ—,å…¶å¾Œåˆ—);
                  if(!å…¶å¾Œåˆ—[æ¬„] && æª¢æŸ¥åˆ—[æ¬„])
                    å…¶å¾Œåˆ—[æ¬„] = æª¢æŸ¥åˆ—[æ¬„];
                }
                åŒå­¸è³‡æ–™åº«.splice(åˆ—--,1); // åˆ—--:spliceå¾Œä¸‹é¢æ‰€æœ‰åˆ—åƒä¸Šä½ç§»
                break;
              }
            }
          }
          åŒå­¸è³‡æ–™åº«.reverse();
          æš«å­˜åŒå­¸è³‡æ–™åº« = åŒå­¸è³‡æ–™åº«;
          é‡è¨­ç‹€æ…‹æ¬„();
          const æ¬„ä½æ¨™é¡Œ = [];
          ç‹€æ…‹æ¬„çºŒå¯«(åŒå­¸è³‡æ–™åº«.reduce(
            (str, row) => `${str}${row[0]}, ${row[1]}, ${row[2]}, ${row[3]}, ${row[4]}\n`,
            'ç§‘ç³», å§“å, å­¸è™Ÿ, é›»è©±, åº§ä½\n'
          ));
          æ‰“äº‚é™£åˆ—(æš«å­˜åŒå­¸è³‡æ–™åº«);
          è¼‰å…¥æç¤º.style.display = 'none';
        } else å½ˆå‡ºéŒ¯èª¤è¨Šæ¯('æŸ¥ç„¡è³‡æ–™');
        document.getElementById(`æŠ½çç³»çµ±åˆ†é `).firstElementChild.src = `draw.html`;
      }
      if(é è¼‰è³‡æ–™) è¼‰å…¥æˆåŠŸ();
      // å–å‡ºåŒå­¸è³‡æ–™
      await gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: '1uPs6CBFz1edahBCSY8HzUTmippmlutsDuhFfvM1tsiw',
        range: 'åŒå­¸è³‡æ–™!B2:F',
      }).then(è¼‰å…¥æˆåŠŸ, å›æ‡‰ => å½ˆå‡ºéŒ¯èª¤è¨Šæ¯('Error: ' + å›æ‡‰.result.error.message));

      // å–å‡ºæ‰€æœ‰çå“è³‡æ–™
      await gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: "1uPs6CBFz1edahBCSY8HzUTmippmlutsDuhFfvM1tsiw",
        range: 'çå“è³‡æ–™!B:D',
      }).then(å›æ‡‰ => {
        è¼‰å…¥æç¤º.style.display = 'flex';
        çå“è³‡æ–™åº« = å›æ‡‰.result.values;
        çå“è³‡æ–™åº«.shift(); //ç§»é™¤æ¨™é¡Œ
        // console.log(çå“è³‡æ–™);
        const çå“åç¨± = çå“è³‡æ–™åº«.map(åˆ— => åˆ—[0]);
        // console.log(çå“åç¨±);
        // å°‡çå“åç¨±æ”¾å…¥é¸å–®
        $('#çå“é¸å–®').html('').append(
          $('<option/>', {
            class: "default text",
            value: "",
            text: "çå“é¸å–®"
          })
        ).append(
          çå“åç¨±.map(åç¨± => {
            return $('<option/>', {
              id: åç¨±,
              value: åç¨±,
              text: åç¨±
            })
          })
        ).change(ev => {
          console.log(ev);
        });
        è¼‰å…¥æç¤º.style.display = 'none';
        document.getElementById(`æŠ½çç³»çµ±åˆ†é `).firstElementChild.src = `draw.html`;
      }, å›æ‡‰ => å½ˆå‡ºéŒ¯èª¤è¨Šæ¯('Error: ' + å›æ‡‰.result.error.message));
    }

    async function ç™»å…¥() {
      è¼‰å…¥æç¤º.style.display = 'flex';
      è¼‰å…¥æŒ‰éˆ•.style.display = 'block';
      ç™»å…¥æŒ‰éˆ•.style.display = 'none';
      if (gapi.auth2.getAuthInstance().isSignedIn.get())
        gapi.auth2.getAuthInstance().signOut();
      gapi.auth2.getAuthInstance().signIn().then(å›æ‡‰ => {
          console.log(å›æ‡‰);
          gapi.auth2.getAuthInstance().isSignedIn.listen(æ›´æ–°ç™»å…¥ç‹€æ…‹)
        } ,å›æ‡‰ => {
          console.log(å›æ‡‰);
          å½ˆå‡ºéŒ¯èª¤è¨Šæ¯('Error: ' + å›æ‡‰.error)
        }
      );
      æ›´æ–°ç™»å…¥ç‹€æ…‹();
    }

    function åœ–ç‰‡ç¶²å€è½‰æ›(ç¶²å€) { // ex: https://drive.google.com/open?id=1ED9oMT0c7wWQy8RAng8AA3hh1s9uo6Ya
      return 'https://drive.google.com/uc?id='+new URLSearchParams(new URL(ç¶²å€).search).get("id");
      let åœ–ç‰‡ç¶²å€;
      console.log(ç¶²å€, new URLSearchParams(new URL(ç¶²å€).search).get("id"));
      // form: https://stackoverflow.com/questions/22607150/getting-the-url-parameters-inside-the-html-page
      // form: https://stackoverflow.com/questions/39381563/get-file-content-of-google-docs-using-google-drive-api-v3
      gapi.client.drive.files.get({
          fileId: new URLSearchParams(new URL(ç¶²å€).search).get("id"),
          fields: 'webContentLink'
      }).then(
        success => åœ–ç‰‡ç¶²å€ = success.result.webContentLink, //the link is in the success.result object
        fail => {
            console.log(fail);
            å½ˆå‡ºéŒ¯èª¤è¨Šæ¯('Error: ' + fail.result.error.message);
        }
      )
      console.log(åœ–ç‰‡ç¶²å€);
      return åœ–ç‰‡ç¶²å€;
    };

    // EventListener
    ç™»å…¥æŒ‰éˆ•.onclick = éŒ¯èª¤è¨Šæ¯è¦–çª—ç™»å…¥æŒ‰éˆ•.onclick = ç™»å…¥;

    ç™»å‡ºæŒ‰éˆ•.onclick = e => {
      é‡è¨­ç‹€æ…‹æ¬„('æ‚¨å·²ç™»å‡º');
      è¼‰å…¥æŒ‰éˆ•.style.display = 'block';
      æš«å­˜åŒå­¸è³‡æ–™åº« = åŒå­¸è³‡æ–™åº« = å·²ä¸­çæš«å­˜è³‡æ–™åº« = [];
      gapi.auth2.getAuthInstance().signOut();
      // From https://stackoverflow.com/questions/179355/clearing-all-cookies-with-javascript
      for (const cookie of document.cookie.split(";")) { // Clearing all cookies
        const eqPos = cookie.indexOf("=");
        const name = eqPos > -1 ? cookie.substring(0, eqPos) : cookie;
        document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
      }
      æ›´æ–°ç™»å…¥ç‹€æ…‹(false);
    };

    è¼‰å…¥æŒ‰éˆ•.onclick = è¼‰å…¥æç¤º.onclick = e => {
      if (æ›´æ–°ç™»å…¥ç‹€æ…‹()) é‡è¼‰è³‡æ–™åº«();
    };

    // When the user clicks on the button, scroll to the top of the document
    è‡³é ‚æŒ‰éˆ•.onclick = e => {
      document.body.scrollTop = 0;
      document.documentElement.scrollTop = 0;
    };

    onfocus = e => æ›´æ–°ç™»å…¥ç‹€æ…‹(undefined, true);
    onblur = e => {
      ç™»å…¥æŒ‰éˆ•.style.display = ç™»å‡ºæŒ‰éˆ•.style.display = 'none';
      è¼‰å…¥æŒ‰éˆ•.style.display = 'block';
    }
    // from https://www.w3schools.com/howto/howto_js_scroll_to_top.asp
    // When the user scrolls down 20px from the top of the document, show the button
    onscroll = e => {
      if (document.body.scrollTop > innerHeight
        || document.documentElement.scrollTop > innerHeight) {
        è‡³é ‚æŒ‰éˆ•.style.display = "block";
      } else {
        è‡³é ‚æŒ‰éˆ•.style.display = "none";
      }
    };

    // Google API ç™»å…¥é©—è­‰
    // From https://developers.google.com/sheets/api/quickstart/js
    // On load, called to load the auth2 library and API client library.
    gapi.load('client:auth2', async () => {
      // Initializes the API client library and sets up sign-in state listeners.
      await gapi.client.init({
        // Client ID and API key from the Developer Console
        clientId: '289902636224-oro06s681gdgk1kqrv8o1oca2shocfr4.apps.googleusercontent.com',
        apiKey: 'AIzaSyCRfe3-dnm9GGMH_PFm9m5WHBMb_8U9HXY',
        /**Array of API discovery doc URLs for APIs used by the quickstart */
        discoveryDocs: [
          'https://sheets.googleapis.com/$discovery/rest?version=v4',
          'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'
        ],
        /**Authorization scopes required by the API; multiple scopes can be
         * included, separated by spaces. */
        scope: "https://www.googleapis.com/auth/spreadsheets.readonly https://www.googleapis.com/auth/drive.metadata.readonly"
      }).then(e => {
        // Listen for sign-in state changes.
        gapi.auth2.getAuthInstance().isSignedIn.listen(æ›´æ–°ç™»å…¥ç‹€æ…‹);
        // Handle the initial sign-in state.
        if (!æ›´æ–°ç™»å…¥ç‹€æ…‹()) ç™»å…¥();
      }, éŒ¯èª¤ => å½ˆå‡ºéŒ¯èª¤è¨Šæ¯(JSON.stringify(éŒ¯èª¤, null, 2)));
    });
    
    gapi.load('client', async () => {
      // Loads the discovery doc to initialize the API after the API client is loaded.
      await gapi.client.init({
        // Set to API key from the Developer Console
        apiKey: 'AIzaSyCRfe3-dnm9GGMH_PFm9m5WHBMb_8U9HXY',
        // Discovery doc URL for APIs used by the quickstart
        discoveryDocs: [
          'https://sheets.googleapis.com/$discovery/rest?version=v4',
          'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'
        ]
      });
    });
    console.log(`api.js is loaded.`);

    let tokenClient = google.accounts.oauth2.initTokenClient({
      // Set to client ID from the Developer Console
      client_id: '289902636224-oro06s681gdgk1kqrv8o1oca2shocfr4.apps.googleusercontent.com',
      // Authorization scopes required by the API; multiple scopes can be included, separated by spaces.
      scope: 'https://www.googleapis.com/auth/spreadsheets.readonly https://www.googleapis.com/auth/drive.metadata.readonly',
      callback: async resp => {
        if (resp.error !== undefined) {
          console.log(resp);
          throw resp;
        }
        await listMajors();// TO-DO
      }
    });
    console.log(`Google Identity Services are loaded.`);
    if(!navigator.onLine){
      åˆ‡æ›åˆ†é ('ç·¨è¼¯è³‡æ–™');
      å½ˆå‡ºéŒ¯èª¤è¨Šæ¯('æœªé€£ç·šï¼Œè«‹ä¸Šå‚³ csv æª”æ¡ˆ', true);
    }
  </script>
</body>

</html>